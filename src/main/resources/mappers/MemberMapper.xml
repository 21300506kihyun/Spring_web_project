<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.omeran.dao.MemberDAO">

	<sql id="login">
		<if test="1 == 1">
			user_table WHERE id=#{id} AND pw = #{pw}
		</if>
	</sql>

  	<select id="getEmail" resultType="String">
	  select name from user_table where u_id = #{id}
	</select>
	
	<select id="getUserInfo" resultType="HashMap">
		SELECT * FROM UserTable JOIN MallTable ON UserTable.mall_id = MallTable.mall_id WHERE user_id = #{id} AND password = #{pw} LIMIT 1;
	</select>
  
	<update id="updateRecentLogin">
		UPDATE user_table SET modify_date=CURRENT_TIMESTAMP, recent_visit=CURRENT_TIMESTAMP WHERE u_id = #{u_id};
	</update>
	
	<!--쿼리의 id -->
	<select id="selectBoardList" parameterType="hashmap" resultType="hashmap"> 
		<![CDATA[ 
		SELECT * 
		FROM Faq_table
		]]> 
	</select>

	<select id="getFaqCount" resultType="int">
		SELECT COUNT(*) FROM Faq_table WHERE title LIKE "%${keyword}%" AND status = 1;
		
	</select>
	
	
	<select id="getFaqList" resultType="HashMap">
		SELECT * FROM Faq_table WHERE title LIKE "%${keyword}%" AND status = 1 ORDER BY faq_id DESC LIMIT #{startIndex}, #{cntPerPage};
	</select>
	
	<select id="insertBoard" parameterType="hashmap"> 
		<![CDATA[ 
			INSERT into 
			Faq_table(title,content, writer, upload_date, status) 
			values (#{TITLE}, #{CONTENTS}, #{writer}, CURRENT_TIMESTAMP, 1);
		]]> 
	</select>

	<update id="updateBoard" parameterType="hashmap"> 
		<![CDATA[ 
			UPDATE Faq_table SET title = #{title},
			content = #{content}
			where faq_id = #{faq_id}
		]]>
	</update>
	
	<update id="deleteFaqBoard">
		UPDATE Faq_table SET modify_date=CURRENT_TIMESTAMP, status=-1 WHERE faq_id = #{faq_id} LIMIT 1;
	</update>
	
	<update id="updateFaqBoard" parameterType="hashmap"> 
		<![CDATA[ 
			UPDATE Faq_table 
			SET title = #{title},
				content = #{contents},
				writer = #{writer}
			WHERE faq_id = #{faq_id}
			LIMIT 1
		]]>
	</update>

  <!-- *********** 쇼핑몰 상품 부분 *************** -->
  
  	<select id="mall_getProductCount" resultType="int">
		SELECT COUNT(*) FROM ProductTable WHERE product_name LIKE "%${keyword}%";	
	</select>
	
	<select id="mall_getProductList" resultType="HashMap">
		SELECT * FROM ProductTable WHERE product_name LIKE "%${keyword}%" LIMIT #{startIndex}, #{cntPerPage};
	</select>
	
	<select id="mall_getProductDetail" resultType="HashMap">
		SELECT * FROM ProductTable WHERE p_id= ${p_id};
	</select>
	
	<!-- ************ 회원가입 부분 ***************8  -->
	
	<select id="insertUserInfo" parameterType="com.project.omeran.dto.UserVO">
		INSERT INTO UserTable(user_id,password,user_name,telephone,gender,email,signin_date,modify_date,user_category)
			VALUES(#{user_id},#{password},#{user_name},#{telephone},#{gender},#{email},now(),now(),1);
	</select>
	
	<select id="idCheck" parameterType="com.project.omeran.dto.UserVO" resultType="int">
		SELECT count(*) FROM UserTable WHERE user_id = #{user_id};
	</select>

	
	<!-- 상품정보 받아오기 -->
	<select id="getAllProductList" resultType="HashMap">
		SELECT * FROM ProductTable JOIN (StateTable) ON ProductTable.state_id=StateTable.state_id WHERE ProductTable.state_id != "delete" AND mall_id = #{mall_id} ORDER BY p_id;
	</select>
	
	<select id="getProductList" resultType="HashMap">
		SELECT * FROM ProductTable JOIN (StateTable) ON ProductTable.state_id=StateTable.state_id WHERE ProductTable.state_id = "${state_id}" AND mall_id = #{mall_id} ORDER BY p_id;
	</select>
	
	<!-- stateTable 정보 가져오기 -->
	<select id="getStateList" resultType="HashMap">
		SELECT * FROM StateTable WHERE state_id LIKE "${category}%";
	</select>

	<update id="productSimpleUpdate"> 
		<![CDATA[ 
			UPDATE ProductTable 
			SET 
				price = #{price}, 
				discount_price = #{discount_price}, 
				state_id = "${stateId}", 
				mod_date = CURRENT_TIMESTAMP 
			WHERE p_id = #{productId};
		]]>
	</update>
	
	<update id="productDelete">
		<!-- <![CDATA[
			DELETE FROM ProductTable
			WHERE p_id = #{productId}
			LIMIT 1;
		]]> -->
		UPDATE ProductTable
		SET
			state_id = "delete",
			mod_date = CURRENT_TIMESTAMP
		WHERE p_id = #{productId};
	</update>
	
	<select id="adminProductCreateNew" parameterType="hashmap"> 
	<!-- INSERT INTO ProductTable (product_name, price, discount_price, reg_date, state_id, summary, detail) VALUES ("오메란 D세트", 40000, 34000, CURRENT_TIMESTAMP, "P003", "오메란 D세트summaryTest", "오메란 D세트 detail입니다."); -->
		<![CDATA[ 
			INSERT INTO ProductTable 
				(product_name, price, discount_price, reg_date, state_id, summary, detail, product_img, mall_id) 
			VALUES 
				("${adminProductDetail_productName}", ${adminProductDetail_productPrice}, ${adminProductDetail_productDiscountPrice}, 
				CURRENT_TIMESTAMP, "${state_id}", "${adminProductDetail_productSummary}", "${adminProductDetail_productDetail}", "${filePath}", "${mall_id}");
		]]>
	</select>
	
	<select id="admin_getProductInfoById" resultType="HashMap">
		SELECT * FROM ProductTable WHERE p_id = #{p_id};
	</select>
	
	<update id="adminProduct_modifyDetail"> 
		<![CDATA[ 
			UPDATE ProductTable 
			SET 
				product_name = "${adminProductDetail_productName}", 
				price=#{adminProductDetail_productPrice}, 
				discount_price=#{adminProductDetail_productDiscountPrice}, 
				mod_date=CURRENT_TIMESTAMP, 
				state_id="${adminProductDetail_state}", 
				summary="${adminProductDetail_productSummary}", 
				detail="${adminProductDetail_productDetail}", 
				product_img="${adminProductDetail_productImageName}" 
			WHERE p_id=#{adminProductDetail_p_id};
		]]>
	</update>


</mapper>

